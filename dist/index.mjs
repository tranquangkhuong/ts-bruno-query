function r(r,t){if(t==null||t>r.length)t=r.length;for(var e=0,a=new Array(t);e<t;e++)a[e]=r[e];return a}function t(r){if(Array.isArray(r))return r}function e(t){if(Array.isArray(t))return r(t)}function a(r,t){if(!(r instanceof t)){throw new TypeError("Cannot call a class as a function")}}function n(r,t){for(var e=0;e<t.length;e++){var a=t[e];a.enumerable=a.enumerable||false;a.configurable=true;if("value"in a)a.writable=true;Object.defineProperty(r,a.key,a)}}function i(r,t,e){if(t)n(r.prototype,t);if(e)n(r,e);return r}function s(r,t,e){if(t in r){Object.defineProperty(r,t,{value:e,enumerable:true,configurable:true,writable:true})}else{r[t]=e}return r}function o(r,t){if(t!=null&&typeof Symbol!=="undefined"&&t[Symbol.hasInstance]){return!!t[Symbol.hasInstance](r)}else{return r instanceof t}}function l(r){if(typeof Symbol!=="undefined"&&r[Symbol.iterator]!=null||r["@@iterator"]!=null)return Array.from(r)}function u(r,t){var e=r==null?null:typeof Symbol!=="undefined"&&r[Symbol.iterator]||r["@@iterator"];if(e==null)return;var a=[];var n=true;var i=false;var s,o;try{for(e=e.call(r);!(n=(s=e.next()).done);n=true){a.push(s.value);if(t&&a.length===t)break}}catch(r){i=true;o=r}finally{try{if(!n&&e["return"]!=null)e["return"]()}finally{if(i)throw o}}return a}function c(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function p(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function f(r){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};var a=Object.keys(e);if(typeof Object.getOwnPropertySymbols==="function"){a=a.concat(Object.getOwnPropertySymbols(e).filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))}a.forEach(function(t){s(r,t,e[t])})}return r}function h(r,e){return t(r)||u(r,e)||d(r,e)||c()}function y(r){return e(r)||l(r)||d(r)||p()}function v(r){"@swc/helpers - typeof";return r&&typeof Symbol!=="undefined"&&r.constructor===Symbol?"symbol":typeof r}function d(t,e){if(!t)return;if(typeof t==="string")return r(t,e);var a=Object.prototype.toString.call(t).slice(8,-1);if(a==="Object"&&t.constructor)a=t.constructor.name;if(a==="Map"||a==="Set")return Array.from(a);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return r(t,e)}var m=Object.defineProperty;var g=function(r,t,e){return t in r?m(r,t,{enumerable:true,configurable:true,writable:true,value:e}):r[t]=e};var _=function(r,t){return m(r,"name",{value:t,configurable:true})};var k=function(r,t,e){return g(r,(typeof t==="undefined"?"undefined":v(t))!="symbol"?t+"":t,e)};var b=function(r){return r.contains="ct",r.startsWith="sw",r.endsWith="ew",r.equals="eq",r.greaterThan="gt",r.greaterThanEqual="gte",r.lessThan="lt",r.lessThanEqual="lte",r.in="in",r.between="bt",r}({}),A=function(r){return r.ASC="ASC",r.DESC="DESC",r}({});var O=/*#__PURE__*/function(){"use strict";function r(){a(this,r);k(this,"_params",{})}i(r,[{key:"addIncludes",value:function r(){for(var r=arguments.length,t=new Array(r),e=0;e<r;e++){t[e]=arguments[e]}return this.addArrayIncludes(t)}},{key:"addArrayIncludes",value:function r(r){var t;return this._params.includes||(this._params.includes=[]),(t=this._params.includes).push.apply(t,y(r)),this}},{key:"setIncludes",value:function r(){for(var r=arguments.length,t=new Array(r),e=0;e<r;e++){t[e]=arguments[e]}return this.setArrayIncludes(t)}},{key:"setArrayIncludes",value:function r(r){return this._params.includes=y(r),this}},{key:"addSort",value:function r(){for(var r=arguments.length,t=new Array(r),e=0;e<r;e++){t[e]=arguments[e]}return this.addArraySort(t)}},{key:"addArraySort",value:function r(r){var t;return this._params.sort||(this._params.sort=[]),(t=this._params.sort).push.apply(t,y(r)),this}},{key:"setSort",value:function r(){for(var r=arguments.length,t=new Array(r),e=0;e<r;e++){t[e]=arguments[e]}return this.setArraySort(t)}},{key:"setArraySort",value:function r(r){return this._params.sort=y(r),this}},{key:"addFilterGroup",value:function r(){for(var r=arguments.length,t=new Array(r),e=0;e<r;e++){t[e]=arguments[e]}return this.addArrayFilterGroup(t)}},{key:"addArrayFilterGroup",value:function r(r){var t=this;var e;this._params.filter_groups||(this._params.filter_groups=[]);var a=r.map(function(r){return t.deduplicateFilters(r)});return(e=this._params.filter_groups).push.apply(e,y(a)),this}},{key:"setFilterGroup",value:function r(){for(var r=arguments.length,t=new Array(r),e=0;e<r;e++){t[e]=arguments[e]}return this.setArrayFilterGroup(t)}},{key:"setArrayFilterGroup",value:function r(r){var t=this;return this._params.filter_groups=r.map(function(r){return t.deduplicateFilters(r)}),this}},{key:"setLimit",value:function t(t){return t===null?(delete this._params.limit,this):(this._params.limit=t<0?r.DEFAULT_LIMIT:t,this)}},{key:"setPage",value:function t(t){return t===null?(delete this._params.page,this):(this._params.page=t<0?r.DEFAULT_PAGE:t,this)}},{key:"setOptional",value:function r(r){return this._params.optional=r,this}},{key:"addOptional",value:function r(r){var t;return this._params.optional?Array.isArray(this._params.optional)&&Array.isArray(r)?(t=this._params.optional).push.apply(t,y(r)):Array.isArray(this._params.optional)&&!Array.isArray(r)?this._params.optional.push(r):!Array.isArray(this._params.optional)&&Array.isArray(r)?this._params.optional=[this._params.optional].concat(y(r)):this._params.optional=f({},this._params.optional,r):this._params.optional=r,this}},{key:"reset",value:function r(){return this._params={},this}},{key:"clone",value:function t(){var t=this;var e=new r;return this._params.includes&&(e._params.includes=y(this._params.includes)),this._params.sort&&(e._params.sort=this._params.sort.map(function(r){return f({},r)})),this._params.limit&&(e._params.limit=this._params.limit),this._params.page&&(e._params.page=this._params.page),this._params.filter_groups&&(e._params.filter_groups=this._params.filter_groups.map(function(r){return t.deduplicateFilters({or:r.or||false,filters:r.filters?r.filters.map(function(r){return Array.isArray(r)?y(r):f({},r)}):[]})})),this._params.optional&&(e._params.optional=Array.isArray(this._params.optional)?this._params.optional.map(function(r){return f({},r)}):f({},this._params.optional)),e}},{key:"deduplicateFilters",value:function r(r){if(!r.filters||r.filters.length===0)return r;var t=new Set,e=[];var a=true,n=false,i=undefined;try{for(var s=r.filters[Symbol.iterator](),o;!(a=(o=s.next()).done);a=true){var l=o.value;var u=void 0,c=void 0,p=void 0,f=void 0;var h,y;Array.isArray(l)?(u=l[0],p=l[1],c=l[2],f=l.length>3?(h=l[3])!==null&&h!==void 0?h:false:false):(u=l.key,p=l.operator,c=l.value,f=(y=l.not)!==null&&y!==void 0?y:false);var v="".concat(u,":").concat(p,":").concat(JSON.stringify(c),":").concat(f);t.has(v)||(t.add(v),e.push(l))}}catch(r){n=true;i=r}finally{try{if(!a&&s.return!=null){s.return()}}finally{if(n){throw i}}}return{or:r.or||false,filters:e}}},{key:"toObject",value:function r(){var r=this;var t={};if(this._params.includes&&(t.includes=y(this._params.includes)),this._params.sort&&(t.sort=y(this._params.sort)),this._params.filter_groups){var e=this._params.filter_groups.map(function(t){var e={or:t.or||false,filters:t.filters.map(function(r){return Array.isArray(r)?f({key:r[0],operator:r[1],value:r[2]},r.length>3?{not:r[3]}:{}):r})};return r.deduplicateFilters(e)});t.filter_groups=e}return this._params.limit&&(t.limit=this._params.limit),this._params.page&&(t.page=this._params.page),this._params.optional&&(t.optional=this._params.optional),t}},{key:"toURL",value:function r(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";var t=this.toQueryString(),e="".concat(r).concat(r.endsWith("?")?"&":"?").concat(t);return e=e.replace(/&{2,}/g,"&"),e=e.replace(/\?&/g,"?"),e}},{key:"toQueryString",value:function r(){var r=[];return this.handleIncludes(r),this.handleSort(r),this.handleFilterGroups(r),this.handleLimitPage(r),this.handleOptional(r),r.join("&")}},{key:"get",value:function r(){return this.toQueryString()}},{key:"toJSON",value:function r(){var r=this.toObject();return r.optional&&(Array.isArray(r.optional)?r.optional.forEach(function(t,e){Object.keys(t).forEach(function(a){r["".concat(a,"_").concat(e)]=t[a]})}):Object.assign(r,r.optional),delete r.optional),JSON.stringify(r)}},{key:"handleIncludes",value:function r(r){!this._params.includes||this._params.includes.length===0||this._params.includes.forEach(function(t){r.push("includes[]=".concat(encodeURIComponent(t)))})}},{key:"handleSort",value:function r(r){!this._params.sort||this._params.sort.length===0||this._params.sort.forEach(function(t,e){var a="sort[".concat(e,"][key]=").concat(encodeURIComponent(t.key)),n="sort[".concat(e,"][direction]=").concat(t.direction);r.push(a,n)})}},{key:"handleLimitPage",value:function r(r){this._params.limit&&r.push("limit=".concat(this._params.limit)),this._params.page&&r.push("page=".concat(this._params.page))}},{key:"handleFilterGroups",value:function r(r){var t=this;!this._params.filter_groups||this._params.filter_groups.length===0||this._params.filter_groups.forEach(function(e,a){e.or&&r.push("filter_groups[".concat(a,"][or]=true")),t.handleFilters(r,e,a)})}},{key:"handleFilters",value:function r(r,t,e){var a=this;(t.filters||[]).forEach(function(t,n){var i="filter_groups[".concat(e,"][filters][").concat(n,"]"),s=a.handleParseFilter(t);Object.keys(s).forEach(function(t){var e=s[t];a.handleValue(r,"".concat(i,"[").concat(t,"]"),e,n)})})}},{key:"handleParseFilter",value:function r(r){var t;return Array.isArray(r)?t=f({key:r[0],operator:r[1],value:r[2]},r.length>3?{not:r[3]}:{}):t=r,t}},{key:"handleOptional",value:function r(r){var t=this;this._params.optional&&(Array.isArray(this._params.optional)?this._params.optional.forEach(function(e,a){t.handleOptionalObject(r,e,a)}):this.handleOptionalObject(r,this._params.optional,0))}},{key:"handleOptionalObject",value:function r(r,t,e){var a=this;Object.keys(t).forEach(function(n){var i=t[n];(typeof i==="undefined"?"undefined":v(i))=="object"&&i!==null&&!Array.isArray(i)?Object.keys(i).forEach(function(t){var s=i[t];a.handleValue(r,"".concat(n,"[").concat(t,"]"),s,e)}):a.handleValue(r,n,i,e)})}},{key:"handleValue",value:function r(r,t,e,a){if(Array.isArray(e))e.forEach(function(e){var a=e===null?"null":e;r.push("".concat(t,"[]=").concat(encodeURIComponent(String(a))))});else if(e===null)r.push("".concat(t,"=null"));else if(typeof e=="boolean")r.push("".concat(t,"=").concat(e?"true":"false"));else{var n=e===null?"null":e;r.push("".concat(t,"=").concat(encodeURIComponent(n)))}}},{key:"parseIncludes",value:function r(r){var t=r.getAll("includes[]");t.length!=0&&this.addIncludes.apply(this,y(t))}},{key:"parseSort",value:function r(r){var t=[],e=0;for(;;){var a=r.get("sort[".concat(e,"][key]")),n=r.get("sort[".concat(e,"][direction]"));if(!a||!n)break;t.push({key:a,direction:n.toUpperCase()==="ASC"?A.ASC:A.DESC}),e++}t.length!=0&&this.addSort.apply(this,y(t))}},{key:"parseLimitPage",value:function r(r){var t=r.get("limit");t&&this.setLimit(parseInt(t,10));var e=r.get("page");e&&this.setPage(parseInt(e,10))}},{key:"parseFilterGroups",value:function r(r){var t=this;var e=[],a={},n=[];r.toString().split("&").forEach(function(r){if(r){var t=h(r.split("="),2),e=t[0],a=t[1];n.push({key:decodeURIComponent(e),value:decodeURIComponent(a||"")})}}),n.forEach(function(r){var t=r.value,e=r.key.match(/^filter_groups\[(\d+)\]\[filters\]\[(\d+)\]\[([^\]]+)\]$/);if(e){var n=h(e,4),i=n[1],s=n[2],o=n[3],l=parseInt(i,10),u=parseInt(s,10);a[l]||(a[l]={}),a[l][u]||(a[l][u]={}),a[l][u][o]=t}}),Object.keys(a).map(function(r){return[r,a[parseInt(r,10)]]}).sort(function(r,t){var e=h(r,1),a=e[0],n=h(t,1),i=n[0];return parseInt(a,10)-parseInt(i,10)}).forEach(function(a){var n=h(a,2),i=n[0],s=n[1];var o=parseInt(i,10),l=[];if(Object.keys(s).map(function(r){return[r,s[parseInt(r,10)]]}).sort(function(r,t){var e=h(r,1),a=e[0],n=h(t,1),i=n[0];return parseInt(a,10)-parseInt(i,10)}).forEach(function(r){var e=h(r,2),a=e[0],n=e[1];n.key&&n.operator&&l.push(t.parseFilter(n.key,n.operator,n.value,n.not))}),l.length>0){var u=r.get("filter_groups[".concat(o,"][or]"))==="true";e.push({or:u,filters:l})}}),e.length&&this.addFilterGroup.apply(this,y(e))}},{key:"parseOptional",value:function r(r){var t=this;var e={},a=[],n=["includes","sort","limit","page","filter_groups"],i=[];r.toString().split("&").forEach(function(r){if(r){var t=h(r.split("="),1),e=t[0],a=decodeURIComponent(e),s=a.split("[")[0];n.indexOf(s)===-1&&i.push(a)}});var o={};i.forEach(function(r){var t=r.split("[")[0];o[t]||(o[t]=[]),o[t].push(r)}),Object.keys(o).forEach(function(n){var i=o[n];if(i.filter(function(r){return r===n}).length>0){var l=r.get(n);l!==null&&(e[n]=t.parseValue(l));return}var u=i.filter(function(r){return!!r.match(new RegExp("^".concat(n,"\\[\\d+\\]")))});if(u.length>0){var c={},p={};u.forEach(function(e){var a=e.match(new RegExp("^".concat(n,"\\[(\\d+)\\]\\[([^\\]]+)\\]")));if(a){var i=h(a,3),s=i[1],o=i[2],l=parseInt(s,10),u=r.get(e);p[l]||(p[l]={}),u!==null&&(p[l][o]=t.parseValue(u))}}),Object.keys(p).map(Number).sort(function(r,t){return r-t}).forEach(function(r){var t=p[r];t.key&&t.value!==void 0?c[t.key]=t.value:Object.assign(c,t)}),Object.keys(c).length>0&&a.push(s({},n,c))}else{var f={};i.forEach(function(e){var a=e.match(new RegExp("^".concat(n,"\\[(.+)\\]$")));if(a){var i=h(a,2),s=i[1],o=r.get(e);o!==null&&t.setNestedValue(f,s,t.parseValue(o))}}),Object.keys(f).length>0&&(e[n]=f)}}),a.length>0?this.setOptional(a):Object.keys(e).length>0&&this.setOptional(e)}},{key:"parseFilter",value:function r(r,t,e,a){return f({key:r,operator:this.parseOperator(t),value:this.parseValue(e)},a==="true"&&{not:true})}},{key:"parseValue",value:function r(r){if(r===null||r==="null")return null;if(r==="true")return true;if(r==="false")return false;var t=parseFloat(r);return!isNaN(t)&&r!==""?t:r}},{key:"parseOperator",value:function r(r){return r?({ct:b.contains,sw:b.startsWith,ew:b.endsWith,eq:b.equals,gt:b.greaterThan,gte:b.greaterThanEqual,lt:b.lessThan,lte:b.lessThanEqual,in:b.in,bt:b.between})[r]||b.equals:b.equals}},{key:"setNestedValue",value:function r(r,t,e){var a=t.split("]["),n=r;for(var i=0;i<a.length-1;i++){var s=a[i];(!n[s]||v(n[s])!="object")&&(n[s]={}),n=n[s]}var o=a[a.length-1];n[o]=e}}],[{key:"build",value:function t(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null,n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null,i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:null;var s=new r;return s.setLimit(n).setPage(i),e&&e.length&&s.addArrayIncludes(e),a&&a.length&&s.addArraySort(a),t&&t.length&&s.addArrayFilterGroup(t),s}},{key:"parse",value:function t(t){return r.fromQueryString(t)}},{key:"fromQueryString",value:function t(t){var e=new r;e.reset();var a=t.startsWith("?")?t.slice(1):t;if(!a)return e;var n=new URLSearchParams(a);return e.parseIncludes(n),e.parseSort(n),e.parseLimitPage(n),e.parseFilterGroups(n),e.parseOptional(n),e}},{key:"fromJSON",value:function t(t){try{var e=JSON.parse(t),a=new r,n=["includes","sort","filter_groups","limit","page"];e.includes&&a.addArrayIncludes(e.includes),e.sort&&a.addArraySort(e.sort),e.limit!==void 0&&a.setLimit(e.limit),e.page!==void 0&&a.setPage(e.page),e.filter_groups&&a.addArrayFilterGroup(e.filter_groups);var i={};return Object.keys(e).forEach(function(r){n.indexOf(r)===-1&&(i[r]=e[r])}),Object.keys(i).length>0&&a.setOptional(i),a}catch(r){throw new Error("Invalid JSON string: ".concat(o(r,Error)?r.message:"Unknown error"))}}}]);return r}();_(O,"BrunoQuery"),k(O,"DEFAULT_LIMIT",15),k(O,"DEFAULT_PAGE",1);var S=O;export{S as BrunoQuery,b as QueryOperator,A as SortDirection};