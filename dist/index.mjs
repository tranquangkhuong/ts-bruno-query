function t(t,e){if(e==null||e>t.length)e=t.length;for(var r=0,a=new Array(e);r<e;r++)a[r]=t[r];return a}function e(t){if(Array.isArray(t))return t}function r(e){if(Array.isArray(e))return t(e)}function a(t,e){if(!(t instanceof e)){throw new TypeError("Cannot call a class as a function")}}function n(t,e){for(var r=0;r<e.length;r++){var a=e[r];a.enumerable=a.enumerable||false;a.configurable=true;if("value"in a)a.writable=true;Object.defineProperty(t,a.key,a)}}function i(t,e,r){if(e)n(t.prototype,e);if(r)n(t,r);return t}function s(t,e,r){if(e in t){Object.defineProperty(t,e,{value:r,enumerable:true,configurable:true,writable:true})}else{t[e]=r}return t}function o(t,e){if(e!=null&&typeof Symbol!=="undefined"&&e[Symbol.hasInstance]){return!!e[Symbol.hasInstance](t)}else{return t instanceof e}}function l(t){if(typeof Symbol!=="undefined"&&t[Symbol.iterator]!=null||t["@@iterator"]!=null)return Array.from(t)}function u(t,e){var r=t==null?null:typeof Symbol!=="undefined"&&t[Symbol.iterator]||t["@@iterator"];if(r==null)return;var a=[];var n=true;var i=false;var s,o;try{for(r=r.call(t);!(n=(s=r.next()).done);n=true){a.push(s.value);if(e&&a.length===e)break}}catch(t){i=true;o=t}finally{try{if(!n&&r["return"]!=null)r["return"]()}finally{if(i)throw o}}return a}function p(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function c(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function f(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};var a=Object.keys(r);if(typeof Object.getOwnPropertySymbols==="function"){a=a.concat(Object.getOwnPropertySymbols(r).filter(function(t){return Object.getOwnPropertyDescriptor(r,t).enumerable}))}a.forEach(function(e){s(t,e,r[e])})}return t}function h(t,r){return e(t)||u(t,r)||d(t,r)||p()}function y(t){return r(t)||l(t)||d(t)||c()}function v(t){"@swc/helpers - typeof";return t&&typeof Symbol!=="undefined"&&t.constructor===Symbol?"symbol":typeof t}function d(e,r){if(!e)return;if(typeof e==="string")return t(e,r);var a=Object.prototype.toString.call(e).slice(8,-1);if(a==="Object"&&e.constructor)a=e.constructor.name;if(a==="Map"||a==="Set")return Array.from(a);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return t(e,r)}var m=Object.defineProperty;var g=function(t,e,r){return e in t?m(t,e,{enumerable:true,configurable:true,writable:true,value:r}):t[e]=r};var _=function(t,e){return m(t,"name",{value:e,configurable:true})};var k=function(t,e,r){return g(t,(typeof e==="undefined"?"undefined":v(e))!="symbol"?e+"":e,r)};var A=function(t){return t.contains="ct",t.startsWith="sw",t.endsWith="ew",t.equals="eq",t.greaterThan="gt",t.greaterThanEqual="gte",t.lessThan="lt",t.lessThanEqual="lte",t.in="in",t.between="bt",t}({}),b=function(t){return t.ASC="ASC",t.DESC="DESC",t}({});var P=/*#__PURE__*/function(){"use strict";function t(){a(this,t);k(this,"_aliasKeysPagination",{limit:null,offset:null,perPage:null,page:null});k(this,"_params",{})}i(t,[{key:"addIncludes",value:function t(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++){e[r]=arguments[r]}return this.addArrayIncludes(e)}},{key:"addArrayIncludes",value:function t(t){var e;return this._params.includes||(this._params.includes=[]),(e=this._params.includes).push.apply(e,y(t)),this}},{key:"setIncludes",value:function t(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++){e[r]=arguments[r]}return this.setArrayIncludes(e)}},{key:"setArrayIncludes",value:function t(t){return this._params.includes=y(t),this}},{key:"addSort",value:function t(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++){e[r]=arguments[r]}return this.addArraySort(e)}},{key:"addArraySort",value:function t(t){var e;return this._params.sort||(this._params.sort=[]),(e=this._params.sort).push.apply(e,y(t)),this._params.sort=this.deduplicateSort(this._params.sort),this}},{key:"setSort",value:function t(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++){e[r]=arguments[r]}return this.setArraySort(e)}},{key:"setArraySort",value:function t(t){return this._params.sort=this.deduplicateSort(y(t)),this}},{key:"addFilterGroup",value:function t(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++){e[r]=arguments[r]}return this.addArrayFilterGroup(e)}},{key:"addArrayFilterGroup",value:function t(t){var e=this;var r;this._params.filter_groups||(this._params.filter_groups=[]);var a=t.map(function(t){return e.deduplicateFilters(t)});return(r=this._params.filter_groups).push.apply(r,y(a)),this}},{key:"setFilterGroup",value:function t(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++){e[r]=arguments[r]}return this.setArrayFilterGroup(e)}},{key:"setArrayFilterGroup",value:function t(t){var e=this;return this._params.filter_groups=t.map(function(t){return e.deduplicateFilters(t)}),this}},{key:"setLimit",value:function e(e,r){return e===null?(delete this._params.limit,this):(this._params.limit=e<0?t.DEFAULT_LIMIT:e,r&&(this._aliasKeysPagination.limit=r),this)}},{key:"setOffset",value:function e(e,r){return e===null?(delete this._params.offset,this):(this._params.offset=e<0?t.DEFAULT_PAGE:e,r&&(this._aliasKeysPagination.offset=r),this)}},{key:"setPerPage",value:function e(e,r){return e===null?(delete this._params.perPage,this):(this._params.perPage=e<0?t.DEFAULT_LIMIT:e,r&&(this._aliasKeysPagination.perPage=r),this)}},{key:"setPage",value:function e(e,r){return e===null?(delete this._params.page,this):(this._params.page=e<0?t.DEFAULT_PAGE:e,r&&(this._aliasKeysPagination.page=r),this)}},{key:"setOptional",value:function t(t){return this._params.optional=t,this}},{key:"addOptional",value:function t(t){var e;return this._params.optional?Array.isArray(this._params.optional)&&Array.isArray(t)?(e=this._params.optional).push.apply(e,y(t)):Array.isArray(this._params.optional)&&!Array.isArray(t)?this._params.optional.push(t):!Array.isArray(this._params.optional)&&Array.isArray(t)?this._params.optional=[this._params.optional].concat(y(t)):this._params.optional=f({},this._params.optional,t):this._params.optional=t,this}},{key:"reset",value:function t(){return this._params={},this._aliasKeysPagination={limit:null,offset:null,perPage:null,page:null},this}},{key:"clone",value:function e(){var e=this;var r=new t;return this._params.includes&&(r._params.includes=y(this._params.includes)),this._params.sort&&(r._params.sort=this.deduplicateSort(this._params.sort.map(function(t){return f({},t)}))),this._params.limit&&(r._params.limit=this._params.limit),this._params.offset&&(r._params.offset=this._params.offset),this._params.perPage&&(r._params.perPage=this._params.perPage),this._params.page&&(r._params.page=this._params.page),this._params.filter_groups&&(r._params.filter_groups=this._params.filter_groups.map(function(t){return e.deduplicateFilters({or:t.or||false,filters:t.filters?t.filters.map(function(t){return Array.isArray(t)?y(t):f({},t)}):[]})})),this._params.optional&&(r._params.optional=Array.isArray(this._params.optional)?this._params.optional.map(function(t){return f({},t)}):f({},this._params.optional)),r._aliasKeysPagination=f({},this._aliasKeysPagination),r}},{key:"deduplicateFilters",value:function t(t){if(!t.filters||t.filters.length===0)return t;var e=new Set,r=[];var a=true,n=false,i=undefined;try{for(var s=t.filters[Symbol.iterator](),o;!(a=(o=s.next()).done);a=true){var l=o.value;var u=void 0,p=void 0,c=void 0,f=void 0;var h,y;Array.isArray(l)?(u=l[0],c=l[1],p=l[2],f=l.length>3?(h=l[3])!==null&&h!==void 0?h:false:false):(u=l.key,c=l.operator,p=l.value,f=(y=l.not)!==null&&y!==void 0?y:false);var v="".concat(u,":").concat(c,":").concat(JSON.stringify(p),":").concat(f);e.has(v)||(e.add(v),r.push(l))}}catch(t){n=true;i=t}finally{try{if(!a&&s.return!=null){s.return()}}finally{if(n){throw i}}}return{or:t.or||false,filters:r}}},{key:"deduplicateSort",value:function t(t){if(!t||t.length===0)return t;var e=new Set,r=[];for(var a=t.length-1;a>=0;a--){var n=t[a];e.has(n.key)||(e.add(n.key),r.unshift(n))}return r}},{key:"toObject",value:function t(){var t=this;var e={};if(this._params.includes&&(e.includes=y(this._params.includes)),this._params.sort&&(e.sort=this.deduplicateSort(y(this._params.sort))),this._params.filter_groups){var r=this._params.filter_groups.map(function(e){var r={or:e.or||false,filters:e.filters.map(function(t){return Array.isArray(t)?f({key:t[0],operator:t[1],value:t[2]},t.length>3?{not:t[3]}:{}):t})};return t.deduplicateFilters(r)});e.filter_groups=r}return this._params.limit&&(this._aliasKeysPagination.limit?e[this._aliasKeysPagination.limit]=this._params.limit:e.limit=this._params.limit),this._params.offset&&(this._aliasKeysPagination.offset?e[this._aliasKeysPagination.offset]=this._params.offset:e.offset=this._params.offset),this._params.perPage&&(this._aliasKeysPagination.perPage?e[this._aliasKeysPagination.perPage]=this._params.perPage:e.perPage=this._params.perPage),this._params.page&&(this._aliasKeysPagination.page?e[this._aliasKeysPagination.page]=this._params.page:e.page=this._params.page),this._params.optional&&(e.optional=this._params.optional),e}},{key:"toURL",value:function t(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";var e=this.toQueryString(),r="".concat(t).concat(t.endsWith("?")?"&":"?").concat(e);return r=r.replace(/&{2,}/g,"&"),r=r.replace(/\?&/g,"?"),r}},{key:"toQueryString",value:function t(){var t=[];return this.handleIncludes(t),this.handleSort(t),this.handleFilterGroups(t),this.handleLimitPage(t),this.handleOptional(t),t.join("&")}},{key:"get",value:function t(){return this.toQueryString()}},{key:"toJSON",value:function t(){var t=this.toObject();return t.optional&&(Array.isArray(t.optional)?t.optional.forEach(function(e,r){Object.keys(e).forEach(function(a){t["".concat(a,"_").concat(r)]=e[a]})}):Object.assign(t,t.optional),delete t.optional),JSON.stringify(t)}},{key:"handleIncludes",value:function t(t){!this._params.includes||this._params.includes.length===0||this._params.includes.forEach(function(e){t.push("includes[]=".concat(encodeURIComponent(e)))})}},{key:"handleSort",value:function t(t){!this._params.sort||this._params.sort.length===0||this._params.sort.forEach(function(e,r){var a="sort[".concat(r,"][key]=").concat(encodeURIComponent(e.key)),n="sort[".concat(r,"][direction]=").concat(e.direction);t.push(a,n)})}},{key:"handleLimitPage",value:function t(t){if(this._params.limit){var e=this._aliasKeysPagination.limit||"limit";t.push("".concat(e,"=").concat(this._params.limit))}if(this._params.offset){var r=this._aliasKeysPagination.offset||"offset";t.push("".concat(r,"=").concat(this._params.offset))}if(this._params.perPage){var a=this._aliasKeysPagination.perPage||"perPage";t.push("".concat(a,"=").concat(this._params.perPage))}if(this._params.page){var n=this._aliasKeysPagination.page||"page";t.push("".concat(n,"=").concat(this._params.page))}}},{key:"handleFilterGroups",value:function t(t){var e=this;!this._params.filter_groups||this._params.filter_groups.length===0||this._params.filter_groups.forEach(function(r,a){r.or&&t.push("filter_groups[".concat(a,"][or]=true")),e.handleFilters(t,r,a)})}},{key:"handleFilters",value:function t(t,e,r){var a=this;(e.filters||[]).forEach(function(e,n){var i="filter_groups[".concat(r,"][filters][").concat(n,"]"),s=a.handleParseFilter(e);Object.keys(s).forEach(function(e){var r=s[e];a.handleValue(t,"".concat(i,"[").concat(e,"]"),r,n)})})}},{key:"handleParseFilter",value:function t(t){var e;return Array.isArray(t)?e=f({key:t[0],operator:t[1],value:t[2]},t.length>3?{not:t[3]}:{}):e=t,e}},{key:"handleOptional",value:function t(t){var e=this;this._params.optional&&(Array.isArray(this._params.optional)?this._params.optional.forEach(function(r,a){e.handleOptionalObject(t,r,a)}):this.handleOptionalObject(t,this._params.optional,0))}},{key:"handleOptionalObject",value:function t(t,e,r){var a=this;Object.keys(e).forEach(function(n){var i=e[n];(typeof i==="undefined"?"undefined":v(i))=="object"&&i!==null&&!Array.isArray(i)?Object.keys(i).forEach(function(e){var s=i[e];a.handleValue(t,"".concat(n,"[").concat(e,"]"),s,r)}):a.handleValue(t,n,i,r)})}},{key:"handleValue",value:function t(t,e,r,a){if(Array.isArray(r))r.forEach(function(r){var a=r===null?"null":r;t.push("".concat(e,"[]=").concat(encodeURIComponent(String(a))))});else if(r===null)t.push("".concat(e,"=null"));else if(typeof r=="boolean")t.push("".concat(e,"=").concat(r?"true":"false"));else{var n=r===null?"null":r;t.push("".concat(e,"=").concat(encodeURIComponent(n)))}}},{key:"parseIncludes",value:function t(t){var e=t.getAll("includes[]");e.length!=0&&this.addIncludes.apply(this,y(e))}},{key:"parseSort",value:function t(t){var e=[],r=0;for(;;){var a=t.get("sort[".concat(r,"][key]")),n=t.get("sort[".concat(r,"][direction]"));if(!a||!n)break;e.push({key:a,direction:n.toUpperCase()==="ASC"?b.ASC:b.DESC}),r++}e.length!=0&&this.addSort.apply(this,y(e))}},{key:"parseLimitPage",value:function t(t){var e=t.get("limit");e&&this.setLimit(parseInt(e,10));var r=t.get("offset");r&&this.setOffset(parseInt(r,10));var a=t.get("perPage");a&&this.setPerPage(parseInt(a,10));var n=t.get("page");n&&this.setPage(parseInt(n,10))}},{key:"parseFilterGroups",value:function t(t){var e=this;var r=[],a={},n=[];t.toString().split("&").forEach(function(t){if(t){var e=h(t.split("="),2),r=e[0],a=e[1];n.push({key:decodeURIComponent(r),value:decodeURIComponent(a||"")})}}),n.forEach(function(t){var e=t.value,r=t.key.match(/^filter_groups\[(\d+)\]\[filters\]\[(\d+)\]\[([^\]]+)\]$/);if(r){var n=h(r,4),i=n[1],s=n[2],o=n[3],l=parseInt(i,10),u=parseInt(s,10);a[l]||(a[l]={}),a[l][u]||(a[l][u]={}),a[l][u][o]=e}}),Object.keys(a).map(function(t){return[t,a[parseInt(t,10)]]}).sort(function(t,e){var r=h(t,1),a=r[0],n=h(e,1),i=n[0];return parseInt(a,10)-parseInt(i,10)}).forEach(function(a){var n=h(a,2),i=n[0],s=n[1];var o=parseInt(i,10),l=[];if(Object.keys(s).map(function(t){return[t,s[parseInt(t,10)]]}).sort(function(t,e){var r=h(t,1),a=r[0],n=h(e,1),i=n[0];return parseInt(a,10)-parseInt(i,10)}).forEach(function(t){var r=h(t,2),a=r[0],n=r[1];n.key&&n.operator&&l.push(e.parseFilter(n.key,n.operator,n.value,n.not))}),l.length>0){var u=t.get("filter_groups[".concat(o,"][or]"))==="true";r.push({or:u,filters:l})}}),r.length&&this.addFilterGroup.apply(this,y(r))}},{key:"parseOptional",value:function t(t){var e=this;var r={},a=[],n=["includes","sort","limit","offset","perPage","page","filter_groups"],i=[];t.toString().split("&").forEach(function(t){if(t){var e=h(t.split("="),1),r=e[0],a=decodeURIComponent(r),s=a.split("[")[0];n.indexOf(s)===-1&&i.push(a)}});var o={};i.forEach(function(t){var e=t.split("[")[0];o[e]||(o[e]=[]),o[e].push(t)}),Object.keys(o).forEach(function(n){var i=o[n];if(i.filter(function(t){return t===n}).length>0){var l=t.get(n);l!==null&&(r[n]=e.parseValue(l));return}var u=i.filter(function(t){return!!t.match(new RegExp("^".concat(n,"\\[\\d+\\]")))});if(u.length>0){var p={},c={};u.forEach(function(r){var a=r.match(new RegExp("^".concat(n,"\\[(\\d+)\\]\\[([^\\]]+)\\]")));if(a){var i=h(a,3),s=i[1],o=i[2],l=parseInt(s,10),u=t.get(r);c[l]||(c[l]={}),u!==null&&(c[l][o]=e.parseValue(u))}}),Object.keys(c).map(Number).sort(function(t,e){return t-e}).forEach(function(t){var e=c[t];e.key&&e.value!==void 0?p[e.key]=e.value:Object.assign(p,e)}),Object.keys(p).length>0&&a.push(s({},n,p))}else{var f={};i.forEach(function(r){var a=r.match(new RegExp("^".concat(n,"\\[(.+)\\]$")));if(a){var i=h(a,2),s=i[1],o=t.get(r);o!==null&&e.setNestedValue(f,s,e.parseValue(o))}}),Object.keys(f).length>0&&(r[n]=f)}}),a.length>0?this.setOptional(a):Object.keys(r).length>0&&this.setOptional(r)}},{key:"parseFilter",value:function t(t,e,r,a){return f({key:t,operator:this.parseOperator(e),value:this.parseValue(r)},a==="true"&&{not:true})}},{key:"parseValue",value:function t(t){if(t===null||t==="null")return null;if(t==="true")return true;if(t==="false")return false;var e=parseFloat(t);return!isNaN(e)&&t!==""?e:t}},{key:"parseOperator",value:function t(t){return t?({ct:A.contains,sw:A.startsWith,ew:A.endsWith,eq:A.equals,gt:A.greaterThan,gte:A.greaterThanEqual,lt:A.lessThan,lte:A.lessThanEqual,in:A.in,bt:A.between})[t]||A.equals:A.equals}},{key:"setNestedValue",value:function t(t,e,r){var a=e.split("]["),n=t;for(var i=0;i<a.length-1;i++){var s=a[i];(!n[s]||v(n[s])!="object")&&(n[s]={}),n=n[s]}var o=a[a.length-1];n[o]=r}}],[{key:"build",value:function e(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null,n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null,i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:null;var s=new t;return s.setLimit(n).setPage(i),r&&r.length&&s.addArrayIncludes(r),a&&a.length&&s.addArraySort(a),e&&e.length&&s.addArrayFilterGroup(e),s}},{key:"parse",value:function e(e){return t.fromQueryString(e)}},{key:"fromQueryString",value:function e(e){var r=new t;r.reset();var a=e.startsWith("?")?e.slice(1):e;if(!a)return r;var n=new URLSearchParams(a);return r.parseIncludes(n),r.parseSort(n),r.parseLimitPage(n),r.parseFilterGroups(n),r.parseOptional(n),r}},{key:"fromJSON",value:function e(e){try{var r=JSON.parse(e),a=new t,n=["includes","sort","filter_groups","limit","offset","perPage","page"];r.includes&&a.addArrayIncludes(r.includes),r.sort&&a.addArraySort(r.sort),r.limit!==void 0&&a.setLimit(r.limit),r.offset!==void 0&&a.setOffset(r.offset),r.perPage!==void 0&&a.setPerPage(r.perPage),r.page!==void 0&&a.setPage(r.page),r.filter_groups&&a.addArrayFilterGroup(r.filter_groups);var i={};return Object.keys(r).forEach(function(t){n.indexOf(t)===-1&&(i[t]=r[t])}),Object.keys(i).length>0&&a.setOptional(i),a}catch(t){throw new Error("Invalid JSON string: ".concat(o(t,Error)?t.message:"Unknown error"))}}}]);return t}();_(P,"BrunoQuery"),k(P,"DEFAULT_LIMIT",15),k(P,"DEFAULT_PAGE",1);var O=P;export{O as BrunoQuery,A as QueryOperator,b as SortDirection};