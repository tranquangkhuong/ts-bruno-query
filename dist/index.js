"use strict";function r(r,t){if(t==null||t>r.length)t=r.length;for(var e=0,a=new Array(t);e<t;e++)a[e]=r[e];return a}function t(r){if(Array.isArray(r))return r}function e(t){if(Array.isArray(t))return r(t)}function a(r,t){if(!(r instanceof t)){throw new TypeError("Cannot call a class as a function")}}function n(r,t){for(var e=0;e<t.length;e++){var a=t[e];a.enumerable=a.enumerable||false;a.configurable=true;if("value"in a)a.writable=true;Object.defineProperty(r,a.key,a)}}function i(r,t,e){if(t)n(r.prototype,t);if(e)n(r,e);return r}function o(r,t,e){if(t in r){Object.defineProperty(r,t,{value:e,enumerable:true,configurable:true,writable:true})}else{r[t]=e}return r}function s(r){if(typeof Symbol!=="undefined"&&r[Symbol.iterator]!=null||r["@@iterator"]!=null)return Array.from(r)}function u(r,t){var e=r==null?null:typeof Symbol!=="undefined"&&r[Symbol.iterator]||r["@@iterator"];if(e==null)return;var a=[];var n=true;var i=false;var o,s;try{for(e=e.call(r);!(n=(o=e.next()).done);n=true){a.push(o.value);if(t&&a.length===t)break}}catch(r){i=true;s=r}finally{try{if(!n&&e["return"]!=null)e["return"]()}finally{if(i)throw s}}return a}function l(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function c(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function p(r){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};var a=Object.keys(e);if(typeof Object.getOwnPropertySymbols==="function"){a=a.concat(Object.getOwnPropertySymbols(e).filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))}a.forEach(function(t){o(r,t,e[t])})}return r}function f(r,e){return t(r)||u(r,e)||v(r,e)||l()}function h(r){return e(r)||s(r)||v(r)||c()}function y(r){"@swc/helpers - typeof";return r&&typeof Symbol!=="undefined"&&r.constructor===Symbol?"symbol":typeof r}function v(t,e){if(!t)return;if(typeof t==="string")return r(t,e);var a=Object.prototype.toString.call(t).slice(8,-1);if(a==="Object"&&t.constructor)a=t.constructor.name;if(a==="Map"||a==="Set")return Array.from(a);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return r(t,e)}var d=Object.defineProperty;var m=function(r,t,e){return t in r?d(r,t,{enumerable:true,configurable:true,writable:true,value:e}):r[t]=e};var g=function(r,t){return d(r,"name",{value:t,configurable:true})};var _=function(r,t,e){return m(r,(typeof t==="undefined"?"undefined":y(t))!="symbol"?t+"":t,e)};var A=function(r){return r.contains="ct",r.startsWith="sw",r.endsWith="ew",r.equals="eq",r.greaterThan="gt",r.greaterThanOrEqual="gte",r.lessThan="lt",r.lessThanOrEqual="lte",r.in="in",r.between="bt",r}({}),k=function(r){return r.ASC="ASC",r.DESC="DESC",r}({});var b=/*#__PURE__*/function(){function r(){a(this,r);_(this,"_params",{includes:[],sort:[],filter_groups:[],limit:15,page:1})}i(r,[{key:"addIncludes",value:function r(){for(var r=arguments.length,t=new Array(r),e=0;e<r;e++){t[e]=arguments[e]}return this.addArrayIncludes(t)}},{key:"addArrayIncludes",value:function r(r){var t;return(t=this._params.includes).push.apply(t,h(r)),this}},{key:"setIncludes",value:function r(){for(var r=arguments.length,t=new Array(r),e=0;e<r;e++){t[e]=arguments[e]}return this.setArrayIncludes(t)}},{key:"setArrayIncludes",value:function r(r){return this._params.includes=h(r),this}},{key:"addSort",value:function r(){for(var r=arguments.length,t=new Array(r),e=0;e<r;e++){t[e]=arguments[e]}return this.addArraySort(t)}},{key:"addArraySort",value:function r(r){var t;return(t=this._params.sort).push.apply(t,h(r)),this}},{key:"setSort",value:function r(){for(var r=arguments.length,t=new Array(r),e=0;e<r;e++){t[e]=arguments[e]}return this.setArraySort(t)}},{key:"setArraySort",value:function r(r){return this._params.sort=h(r),this}},{key:"addFilterGroup",value:function r(){for(var r=arguments.length,t=new Array(r),e=0;e<r;e++){t[e]=arguments[e]}return this.addArrayFilterGroup(t)}},{key:"addArrayFilterGroup",value:function r(r){var t;return(t=this._params.filter_groups).push.apply(t,h(r)),this}},{key:"setFilterGroup",value:function r(){for(var r=arguments.length,t=new Array(r),e=0;e<r;e++){t[e]=arguments[e]}return this.setArrayFilterGroup(t)}},{key:"setArrayFilterGroup",value:function r(r){return this._params.filter_groups=h(r),this}},{key:"setLimit",value:function t(t){return this._params.limit=t<0?r.DEFAULT_LIMIT:t,this}},{key:"setPage",value:function t(t){return this._params.page=t<0?r.DEFAULT_PAGE:t,this}},{key:"setOptional",value:function r(r){return this._params.optional=r,this}},{key:"addOptional",value:function r(r){var t;return this._params.optional?Array.isArray(this._params.optional)&&Array.isArray(r)?(t=this._params.optional).push.apply(t,h(r)):Array.isArray(this._params.optional)&&!Array.isArray(r)?this._params.optional.push(r):!Array.isArray(this._params.optional)&&Array.isArray(r)?this._params.optional=[this._params.optional].concat(h(r)):this._params.optional=p({},this._params.optional,r):this._params.optional=r,this}},{key:"reset",value:function t(){return this._params.includes=[],this._params.sort=[],this._params.limit=r.DEFAULT_LIMIT,this._params.page=r.DEFAULT_PAGE,this._params.filter_groups=[],delete this._params.optional,this}},{key:"clone",value:function t(){var t=new r;return t._params=p({includes:h(this._params.includes),sort:this._params.sort.map(function(r){return p({},r)}),limit:this._params.limit,page:this._params.page,filter_groups:this._params.filter_groups.map(function(r){return{or:r.or||false,filters:r.filters?r.filters.map(function(r){return Array.isArray(r)?h(r):p({},r)}):[]}})},this._params.optional&&{optional:Array.isArray(this._params.optional)?this._params.optional.map(function(r){return p({},r)}):p({},this._params.optional)}),t}},{key:"toObject",value:function r(){var r=this._params.filter_groups.map(function(r){return{or:r.or||false,filters:r.filters.map(function(r){return Array.isArray(r)?p({key:r[0],operator:r[1],value:r[2]},r.length>3?{not:r[3]}:{}):r})}});return p({includes:h(this._params.includes),sort:h(this._params.sort),filter_groups:r,limit:this._params.limit,page:this._params.page},this._params.optional&&{optional:this._params.optional})}},{key:"toURL",value:function r(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";var t=this.toQueryString(),e="".concat(r).concat(r.includes("?")?"&":"?").concat(t);return e=e.replace(/&{2,}/g,"&"),e=e.replace(/\?&/g,"?"),e}},{key:"toQueryString",value:function r(){var r=[];return this.handleIncludes(r),this.handleSort(r),this.handleFilterGroups(r),this.handleLimitPage(r),this.handleOptional(r),r.join("&")}},{key:"get",value:function r(){return this.toQueryString()}},{key:"handleIncludes",value:function r(r){this._params.includes.length!==0&&this._params.includes.forEach(function(t){r.push("includes[]=".concat(encodeURIComponent(t)))})}},{key:"handleSort",value:function r(r){this._params.sort.length!==0&&this._params.sort.forEach(function(t,e){var a="sort[".concat(e,"][key]=").concat(encodeURIComponent(t.key)),n="sort[".concat(e,"][direction]=").concat(t.direction);r.push(a,n)})}},{key:"handleLimitPage",value:function r(r){r.push("limit=".concat(this._params.limit),"page=".concat(this._params.page))}},{key:"handleFilterGroups",value:function r(r){var t=this;this._params.filter_groups.length!==0&&this._params.filter_groups.forEach(function(e,a){e.or&&r.push("filter_groups[".concat(a,"][or]=true")),t.handleFilters(r,e,a)})}},{key:"handleFilters",value:function r(r,t,e){var a=this;(t.filters||[]).forEach(function(t,n){var i="filter_groups[".concat(e,"][filters][").concat(n,"]"),o=a.handleParseFilter(t);Object.keys(o).forEach(function(t){var e=o[t];a.handleValue(r,"".concat(i,"[").concat(t,"]"),e,n)})})}},{key:"handleParseFilter",value:function r(r){var t;return Array.isArray(r)?t=p({key:r[0],operator:r[1],value:r[2]},r.length>3?{not:r[3]}:{}):t=r,t}},{key:"handleOptional",value:function r(r){var t=this;this._params.optional&&(Array.isArray(this._params.optional)?this._params.optional.forEach(function(e,a){t.handleOptionalObject(r,e,a)}):this.handleOptionalObject(r,this._params.optional,0))}},{key:"handleOptionalObject",value:function r(r,t,e){var a=this;Object.keys(t).forEach(function(n){var i=t[n];(typeof i==="undefined"?"undefined":y(i))=="object"&&i!==null&&!Array.isArray(i)?Object.keys(i).forEach(function(t){var o=i[t];a.handleValue(r,"".concat(n,"[").concat(t,"]"),o,e)}):a.handleValue(r,n,i,e)})}},{key:"handleValue",value:function r(r,t,e,a){if(Array.isArray(e))e.forEach(function(e){var a=e===null?"null":e;r.push("".concat(t,"[]=").concat(encodeURIComponent(String(a))))});else if(e===null)r.push("".concat(t,"=null"));else if(typeof e=="boolean")r.push("".concat(t,"=").concat(e?"true":"false"));else{var n=e===null?"null":e;r.push("".concat(t,"=").concat(encodeURIComponent(n)))}}},{key:"parseIncludes",value:function r(r){var t=r.getAll("includes[]");t.length!=0&&this.addIncludes.apply(this,h(t))}},{key:"parseSort",value:function r(r){var t=[],e=0;for(;;){var a=r.get("sort[".concat(e,"][key]")),n=r.get("sort[".concat(e,"][direction]"));if(!a||!n)break;t.push({key:a,direction:n.toUpperCase()==="ASC"?k.ASC:k.DESC}),e++}t.length!=0&&this.addSort.apply(this,h(t))}},{key:"parseLimitPage",value:function r(r){var t=r.get("limit");t&&this.setLimit(parseInt(t,10));var e=r.get("page");e&&this.setPage(parseInt(e,10))}},{key:"parseFilterGroups",value:function r(r){var t=this;var e=[],a={},n=[];r.toString().split("&").forEach(function(r){if(r){var t=f(r.split("="),2),e=t[0],a=t[1];n.push({key:decodeURIComponent(e),value:decodeURIComponent(a||"")})}}),n.forEach(function(r){var t=r.value,e=r.key.match(/^filter_groups\[(\d+)\]\[filters\]\[(\d+)\]\[([^\]]+)\]$/);if(e){var n=f(e,4),i=n[1],o=n[2],s=n[3],u=parseInt(i,10),l=parseInt(o,10);a[u]||(a[u]={}),a[u][l]||(a[u][l]={}),a[u][l][s]=t}}),Object.keys(a).map(function(r){return[r,a[parseInt(r,10)]]}).sort(function(r,t){var e=f(r,1),a=e[0],n=f(t,1),i=n[0];return parseInt(a,10)-parseInt(i,10)}).forEach(function(a){var n=f(a,2),i=n[0],o=n[1];var s=parseInt(i,10),u=[];if(Object.keys(o).map(function(r){return[r,o[parseInt(r,10)]]}).sort(function(r,t){var e=f(r,1),a=e[0],n=f(t,1),i=n[0];return parseInt(a,10)-parseInt(i,10)}).forEach(function(r){var e=f(r,2),a=e[0],n=e[1];n.key&&n.operator&&u.push(t.parseFilter(n.key,n.operator,n.value,n.not))}),u.length>0){var l=r.get("filter_groups[".concat(s,"][or]"))==="true";e.push({or:l,filters:u})}}),e.length&&this.addFilterGroup.apply(this,h(e))}},{key:"parseOptional",value:function r(r){var t=this;var e={},a=[],n=["includes","sort","limit","page","filter_groups"],i=[];r.toString().split("&").forEach(function(r){if(r){var t=f(r.split("="),1),e=t[0],a=decodeURIComponent(e),o=a.split("[")[0];n.indexOf(o)===-1&&i.push(a)}});var s={};i.forEach(function(r){var t=r.split("[")[0];s[t]||(s[t]=[]),s[t].push(r)}),Object.keys(s).forEach(function(n){var i=s[n];if(i.filter(function(r){return r===n}).length>0){var u=r.get(n);u!==null&&(e[n]=t.parseValue(u));return}var l=i.filter(function(r){return!!r.match(new RegExp("^".concat(n,"\\[\\d+\\]")))});if(l.length>0){var c={},p={};l.forEach(function(e){var a=e.match(new RegExp("^".concat(n,"\\[(\\d+)\\]\\[([^\\]]+)\\]")));if(a){var i=f(a,3),o=i[1],s=i[2],u=parseInt(o,10),l=r.get(e);p[u]||(p[u]={}),l!==null&&(p[u][s]=t.parseValue(l))}}),Object.keys(p).map(Number).sort(function(r,t){return r-t}).forEach(function(r){var t=p[r];t.key&&t.value!==void 0?c[t.key]=t.value:Object.assign(c,t)}),Object.keys(c).length>0&&a.push(o({},n,c))}else{var h={};i.forEach(function(e){var a=e.match(new RegExp("^".concat(n,"\\[(.+)\\]$")));if(a){var i=f(a,2),o=i[1],s=r.get(e);s!==null&&t.setNestedValue(h,o,t.parseValue(s))}}),Object.keys(h).length>0&&(e[n]=h)}}),a.length>0?this.setOptional(a):Object.keys(e).length>0&&this.setOptional(e)}},{key:"parseFilter",value:function r(r,t,e,a){return p({key:r,operator:this.parseOperator(t),value:this.parseValue(e)},a==="true"&&{not:true})}},{key:"parseValue",value:function r(r){if(r===null||r==="null")return null;if(r==="true")return true;if(r==="false")return false;var t=parseFloat(r);return!isNaN(t)&&r!==""?t:r}},{key:"parseOperator",value:function r(r){return r?({ct:A.contains,sw:A.startsWith,ew:A.endsWith,eq:A.equals,gt:A.greaterThan,gte:A.greaterThanOrEqual,lt:A.lessThan,lte:A.lessThanOrEqual,in:A.in,bt:A.between})[r]||A.equals:A.equals}},{key:"setNestedValue",value:function r(r,t,e){var a=t.split("]["),n=r;for(var i=0;i<a.length-1;i++){var o=a[i];(!n[o]||y(n[o])!="object")&&(n[o]={}),n=n[o]}var s=a[a.length-1];n[s]=e}}],[{key:"build",value:function t(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null,n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:r.DEFAULT_LIMIT,i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:r.DEFAULT_PAGE;var o=new r;return o.setLimit(n).setPage(i),e&&e.length&&o.addArrayIncludes(e),a&&a.length&&o.addArraySort(a),t&&t.length&&o.addArrayFilterGroup(t),o}},{key:"parse",value:function t(t){return r.fromQueryString(t)}},{key:"fromQueryString",value:function t(t){var e=new r;e.reset();var a=t.startsWith("?")?t.slice(1):t;if(!a)return e;var n=new URLSearchParams(a);return e.parseIncludes(n),e.parseSort(n),e.parseLimitPage(n),e.parseFilterGroups(n),e.parseOptional(n),e}}]);return r}();g(b,"BrunoQuery"),_(b,"DEFAULT_LIMIT",15),_(b,"DEFAULT_PAGE",1);var E=b;exports.BrunoQuery=E;exports.QueryOperator=A;exports.SortDirection=k;